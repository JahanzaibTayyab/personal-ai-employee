<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Employee | Mission Control</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
</head>
<body>

    <header class="header">
        <div class="header-left">
            <div class="logo">
                <span class="logo-icon"><i data-lucide="bot" style="width:16px;height:16px;color:#fff"></i></span>
                <span class="logo-text">AI Employee</span>
            </div>
            <nav class="header-tabs" id="header-tabs">
                <button class="tab-trigger active" data-tab="overview">
                    <i data-lucide="layout-dashboard" class="tab-icon"></i> Overview
                </button>
                <button class="tab-trigger" data-tab="social">
                    <i data-lucide="share-2" class="tab-icon"></i> Social Media
                </button>
                <button class="tab-trigger" data-tab="operations">
                    <i data-lucide="settings-2" class="tab-icon"></i> Operations
                </button>
            </nav>
        </div>
        <div class="header-right">
            <div class="header-status">
                <span class="dot"></span>
                <span>System Online</span>
            </div>
            <div class="timestamp" id="timestamp"></div>
            <button class="refresh-btn" onclick="refreshAll()">
                <i data-lucide="refresh-cw" style="width:13px;height:13px"></i>
                Refresh
            </button>
        </div>
    </header>

    <main class="dashboard">

        <!-- ═══ OVERVIEW TAB ═══ -->
        <div class="tab-content active" id="tab-overview">

            <div class="metrics-row">
                <div class="metric-card" data-type="inbox">
                    <div class="metric-label"><i data-lucide="inbox" class="metric-icon"></i> Inbox</div>
                    <div class="metric-value" id="inbox-count">--</div>
                    <div class="metric-sub">items waiting</div>
                </div>
                <div class="metric-card" data-type="pending">
                    <div class="metric-label"><i data-lucide="clock" class="metric-icon"></i> Needs Action</div>
                    <div class="metric-value" id="needs-action-count">--</div>
                    <div class="metric-sub">to process</div>
                </div>
                <div class="metric-card" data-type="done">
                    <div class="metric-label"><i data-lucide="check-circle-2" class="metric-icon"></i> Completed</div>
                    <div class="metric-value" id="done-count">--</div>
                    <div class="metric-sub">items done</div>
                </div>
                <div class="metric-card" data-type="quarantine">
                    <div class="metric-label"><i data-lucide="shield-alert" class="metric-icon"></i> Quarantine</div>
                    <div class="metric-value" id="quarantine-count">--</div>
                    <div class="metric-sub">flagged</div>
                </div>
            </div>

            <div class="content-grid">
                <div class="stack">
                    <!-- Approvals -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="shield-check" class="panel-icon"></i> Pending Approvals</div>
                            <span class="panel-count" id="approval-badge">0</span>
                        </div>
                        <div class="panel-body" id="approvals-list">
                            <div class="loading">Loading approvals...</div>
                        </div>
                    </div>

                    <!-- Plans -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="git-branch" class="panel-icon"></i> Active Plans</div>
                            <span class="panel-count" id="plan-badge">0</span>
                        </div>
                        <div class="panel-body" id="plans-list">
                            <div class="loading">Loading plans...</div>
                        </div>
                    </div>

                    <!-- Schedules -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="calendar-clock" class="panel-icon"></i> Scheduled Tasks</div>
                            <span class="panel-count" id="schedule-badge">0</span>
                        </div>
                        <div class="panel-body" id="schedules-list">
                            <div class="loading">Loading schedules...</div>
                        </div>
                    </div>
                </div>

                <div class="stack">
                    <!-- Quick Actions -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="zap" class="panel-icon"></i> Quick Actions</div>
                        </div>
                        <div class="action-grid">
                            <button class="action-btn" onclick="openModal('email-modal')">
                                <i data-lucide="mail" class="action-icon"></i>
                                <span class="action-label">Send Email</span>
                            </button>
                            <button class="action-btn" onclick="openModal('linkedin-modal')">
                                <i data-lucide="linkedin" class="action-icon"></i>
                                <span class="action-label">Post LinkedIn</span>
                            </button>
                            <button class="action-btn" onclick="openModal('plan-modal')">
                                <i data-lucide="clipboard-list" class="action-icon"></i>
                                <span class="action-label">Create Plan</span>
                            </button>
                            <button class="action-btn" onclick="runProcessInbox()">
                                <i data-lucide="play" class="action-icon"></i>
                                <span class="action-label">Process Inbox</span>
                            </button>
                            <button class="action-btn" onclick="openModal('task-modal')">
                                <i data-lucide="bot" class="action-icon"></i>
                                <span class="action-label">Start Task</span>
                            </button>
                            <button class="action-btn" onclick="openModal('meta-modal')">
                                <i data-lucide="facebook" class="action-icon"></i>
                                <span class="action-label">Meta Post</span>
                            </button>
                            <button class="action-btn" onclick="openModal('tweet-modal')">
                                <i data-lucide="twitter" class="action-icon"></i>
                                <span class="action-label">Tweet</span>
                            </button>
                            <button class="action-btn" onclick="generateBriefing()">
                                <i data-lucide="bar-chart-3" class="action-icon"></i>
                                <span class="action-label">CEO Briefing</span>
                            </button>
                        </div>
                    </div>

                    <!-- System Health -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="heart-pulse" class="panel-icon"></i> System Health</div>
                        </div>
                        <div id="health-status">
                            <div class="loading">Checking health...</div>
                        </div>
                    </div>

                    <!-- Watchers -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="eye" class="panel-icon"></i> Watchers</div>
                        </div>
                        <div class="watchers-inline">
                            <div class="watcher-chip">
                                <span class="dot" id="file-watcher-dot"></span>
                                <span>File</span>
                                <span id="file-watcher-label">stopped</span>
                            </div>
                            <div class="watcher-chip">
                                <span class="dot" id="gmail-watcher-dot"></span>
                                <span>Gmail</span>
                                <span id="gmail-watcher-label">stopped</span>
                            </div>
                            <div class="watcher-chip">
                                <span class="dot" id="whatsapp-watcher-dot"></span>
                                <span>WhatsApp</span>
                                <span id="whatsapp-watcher-label">stopped</span>
                            </div>
                            <div class="watcher-chip">
                                <span class="dot" id="approval-watcher-dot"></span>
                                <span>Approval</span>
                                <span id="approval-watcher-label">stopped</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ═══ SOCIAL MEDIA TAB ═══ -->
        <div class="tab-content" id="tab-social">

            <div class="content-grid--equal">
                <div class="stack">
                    <!-- Meta Posts -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="facebook" class="panel-icon"></i> Meta Posts</div>
                            <span class="panel-count" id="meta-badge">0</span>
                        </div>
                        <div class="panel-body" id="meta-list">
                            <div class="loading">Loading posts...</div>
                        </div>
                    </div>

                    <!-- LinkedIn -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="linkedin" class="panel-icon"></i> LinkedIn Posts</div>
                        </div>
                        <div class="panel-body">
                            <div class="empty-state">LinkedIn posts appear in Approvals after queuing</div>
                        </div>
                    </div>
                </div>

                <div class="stack">
                    <!-- Tweets -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="twitter" class="panel-icon"></i> Tweets</div>
                            <span class="panel-count" id="twitter-badge">0</span>
                        </div>
                        <div class="panel-body" id="twitter-list">
                            <div class="loading">Loading tweets...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ═══ OPERATIONS TAB ═══ -->
        <div class="tab-content" id="tab-operations">

            <div class="content-grid">
                <div class="stack">
                    <!-- Ralph Wiggum Tasks -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="bot" class="panel-icon"></i> Ralph Wiggum Tasks</div>
                            <span class="panel-count" id="task-badge">0</span>
                        </div>
                        <div class="panel-body" id="tasks-list">
                            <div class="loading">Loading tasks...</div>
                        </div>
                    </div>

                    <!-- CEO Briefings -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="file-bar-chart" class="panel-icon"></i> CEO Briefings</div>
                            <span class="panel-count" id="briefing-badge">0</span>
                        </div>
                        <div class="panel-body" id="briefings-list">
                            <div class="loading">Loading briefings...</div>
                        </div>
                    </div>

                    <!-- Audit Log -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="scroll-text" class="panel-icon"></i> Audit Log</div>
                            <span class="panel-count" id="audit-badge">0</span>
                        </div>
                        <div class="panel-body" id="audit-list">
                            <div class="loading">Loading audit log...</div>
                        </div>
                    </div>
                </div>

                <div class="stack">
                    <!-- Invoices -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="receipt" class="panel-icon"></i> Invoices</div>
                            <span class="panel-count" id="invoice-badge">0</span>
                        </div>
                        <div class="panel-body" id="invoices-list">
                            <div class="loading">Loading invoices...</div>
                        </div>
                    </div>

                    <!-- Cross-Domain Search -->
                    <div class="panel">
                        <div class="panel-header">
                            <div class="panel-title"><i data-lucide="search" class="panel-icon"></i> Cross-Domain Search</div>
                        </div>
                        <div class="search-wrap">
                            <input type="text" id="search-query" placeholder="Search across all domains..." onkeydown="if(event.key==='Enter') searchCorrelations()">
                            <button class="btn btn--primary btn--sm" onclick="searchCorrelations()">Search</button>
                        </div>
                        <div class="search-results" id="search-results"></div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- ═══ DETAIL MODAL (reusable) ═══ -->
    <div class="modal" id="detail-modal">
        <div class="modal-backdrop" onclick="closeDetailModal()"></div>
        <div class="modal-content" id="detail-modal-content">
            <div class="modal-header">
                <h3 id="detail-modal-title">Details</h3>
                <button class="modal-close" onclick="closeDetailModal()">&times;</button>
            </div>
            <div class="modal-body" id="detail-modal-body"></div>
            <div class="modal-footer" id="detail-modal-footer"></div>
        </div>
    </div>

    <!-- ═══ ACTION MODALS ═══ -->

    <!-- Email Modal -->
    <div class="modal" id="email-modal">
        <div class="modal-backdrop" onclick="closeModal('email-modal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i data-lucide="mail" class="modal-title-icon"></i> Compose Email</h3>
                <button class="modal-close" onclick="closeModal('email-modal')">&times;</button>
            </div>
            <form id="email-form" onsubmit="sendEmail(event)">
                <div class="form-group">
                    <label>To</label>
                    <input type="email" id="email-to" required placeholder="recipient@example.com">
                </div>
                <div class="form-group">
                    <label>CC</label>
                    <input type="text" id="email-cc" placeholder="cc@example.com (optional)">
                </div>
                <div class="form-group">
                    <label>Subject</label>
                    <input type="text" id="email-subject" required placeholder="Email subject">
                </div>
                <div class="form-group">
                    <label>Body</label>
                    <textarea id="email-body" rows="6" required placeholder="Email content..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn--secondary" onclick="closeModal('email-modal')">Cancel</button>
                    <button type="submit" class="btn btn--primary">Queue for Approval</button>
                </div>
            </form>
        </div>
    </div>

    <!-- LinkedIn Modal -->
    <div class="modal" id="linkedin-modal">
        <div class="modal-backdrop" onclick="closeModal('linkedin-modal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i data-lucide="linkedin" class="modal-title-icon"></i> LinkedIn Post</h3>
                <button class="modal-close" onclick="closeModal('linkedin-modal')">&times;</button>
            </div>
            <form id="linkedin-form" onsubmit="postLinkedIn(event)">
                <div class="form-group">
                    <label>Post Content</label>
                    <textarea id="linkedin-content" rows="8" required placeholder="Write your LinkedIn post..."></textarea>
                    <div class="char-count"><span id="linkedin-chars">0</span>/3000</div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn--secondary" onclick="closeModal('linkedin-modal')">Cancel</button>
                    <button type="submit" class="btn btn--primary">Queue for Approval</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Plan Modal -->
    <div class="modal" id="plan-modal">
        <div class="modal-backdrop" onclick="closeModal('plan-modal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i data-lucide="clipboard-list" class="modal-title-icon"></i> Create Plan</h3>
                <button class="modal-close" onclick="closeModal('plan-modal')">&times;</button>
            </div>
            <form id="plan-form" onsubmit="createPlan(event)">
                <div class="form-group">
                    <label>Objective</label>
                    <input type="text" id="plan-objective" required placeholder="What do you want to accomplish?">
                </div>
                <div class="form-group">
                    <label>Description / Steps</label>
                    <textarea id="plan-description" rows="4" placeholder="Additional context or numbered steps (optional)"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn--secondary" onclick="closeModal('plan-modal')">Cancel</button>
                    <button type="submit" class="btn btn--primary">Create Plan</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task Modal -->
    <div class="modal" id="task-modal">
        <div class="modal-backdrop" onclick="closeModal('task-modal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i data-lucide="bot" class="modal-title-icon"></i> Start Ralph Wiggum Task</h3>
                <button class="modal-close" onclick="closeModal('task-modal')">&times;</button>
            </div>
            <form id="task-form" onsubmit="createTask(event)">
                <div class="form-group">
                    <label>Task Prompt</label>
                    <textarea id="task-prompt" rows="6" required placeholder="Describe the task for Ralph Wiggum to execute autonomously..."></textarea>
                </div>
                <div class="form-group">
                    <label>Max Iterations</label>
                    <input type="number" id="task-max-iter" value="10" min="1" max="50">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn--secondary" onclick="closeModal('task-modal')">Cancel</button>
                    <button type="submit" class="btn btn--primary">Start Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Meta Post Modal -->
    <div class="modal" id="meta-modal">
        <div class="modal-backdrop" onclick="closeModal('meta-modal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i data-lucide="facebook" class="modal-title-icon"></i> Create Meta Post</h3>
                <button class="modal-close" onclick="closeModal('meta-modal')">&times;</button>
            </div>
            <form id="meta-form" onsubmit="createMetaPost(event)">
                <div class="form-group">
                    <label>Platform</label>
                    <select id="meta-platform">
                        <option value="facebook">Facebook</option>
                        <option value="instagram">Instagram</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Post Content</label>
                    <textarea id="meta-content" rows="6" required placeholder="Write your Facebook/Instagram post..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn--secondary" onclick="closeModal('meta-modal')">Cancel</button>
                    <button type="submit" class="btn btn--primary">Create Post</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Tweet Modal -->
    <div class="modal" id="tweet-modal">
        <div class="modal-backdrop" onclick="closeModal('tweet-modal')"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h3><i data-lucide="twitter" class="modal-title-icon"></i> Compose Tweet</h3>
                <button class="modal-close" onclick="closeModal('tweet-modal')">&times;</button>
            </div>
            <form id="tweet-form" onsubmit="createTweet(event)">
                <div class="form-group">
                    <label>Tweet Content</label>
                    <textarea id="tweet-content" rows="4" required maxlength="280" placeholder="What's happening?"></textarea>
                    <div class="char-count"><span id="tweet-chars">0</span>/280</div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn--secondary" onclick="closeModal('tweet-modal')">Cancel</button>
                    <button type="submit" class="btn btn--primary">Create Tweet</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script src="/static/js/dashboard.js"></script>
</body>
</html>
